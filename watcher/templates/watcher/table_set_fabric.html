<head>
    <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.css">
    <style>
        .controls {
            display: inline-block;
        }
    </style>
</head>

<body>

    <div class="row">
        <p>
            <button id="add" onclick="Add()">Add a rectangle</button>
        </p>
        <p>
            <input type="checkbox" id='is_delete'> delete
        </p>
        <p>
            <button id="get_objects" onclick="get_objects()">get objects</button>
        </p>
    </div>
    <canvas id="c" width="1000" height="1000" style="border:1px solid #ccc"></canvas>
</body>

<script src="/static/js/jquery-3.5.1.min.js"></script>
<script src="/static/js/bootstrap.js"></script>
<script src="/static/js/bootstrap.bundle.js"></script>
<script src="/static/js/fabric.js"></script>
<script>
    var canvas = this.__canvas = new fabric.Canvas('c');
    canvas.setBackgroundImage('/static/img/Picture 24.jpg');
    // create a rect object
    fabric.Object.prototype.transparentCorners = false;
    fabric.Object.prototype.cornerColor = 'blue';
    fabric.Object.prototype.cornerStyle = 'circle';


    function Add(_left = 100, _top = 50) {
        var rect = new fabric.Rect({
            left: _left,
            top: _top,
            fill: 'yellow',
            width: 200,
            height: 100,
            objectCaching: false,
            stroke: 'lightgreen',
            strokeWidth: 4,
            opacity: 0.4,
            hasRotatingPoint: false,
        });
        canvas.add(rect);
        canvas.setActiveObject(rect);
    
    }

    function deleteObject(eventData, target) {
        var canvas = target.canvas;
        canvas.remove(target);
        canvas.requestRenderAll();
    }

    canvas.on('mouse:down', function(options) {

        var is_delete = $('#is_delete').prop('checked')

        if(is_delete){
            canvas.remove(options.target);
            canvas.requestRenderAll();        
        }
        else {
            if(options.target == null){
                Add(options.pointer.x, options.pointer.y)
            }
        }

    });

    function get_objects(){
        var pos_data_list = []
        var rect_list = canvas.getObjects()
        console.log(canvas.width + ', ' + canvas.height)
        console.log(rect_list)
        for(var i=0; i<rect_list.length; i++){
            var cur_rec = rect_list[i];
            var pos_data = {
                'f_x' : cur_rec.left/canvas.width,
                'f_y' : cur_rec.top/canvas.height,
                's_x' : (cur_rec.left+cur_rec.width)/canvas.width,
                's_y' : (cur_rec.top+cur_rec.height)/canvas.height,
            }
            pos_data_list.push(pos_data)
        }

        console.log(pos_data_list)
    }

    $(document).ready(function(e){
        canvas.renderAll();
    });

</script>