<!DOCTYPE html>
<html lang="kr">
<head>
	<meta charset="uft-8">
	<meta name="viewprot" content="width=device-width, inital-scale=1, shrinkt-to-fit=no">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
	
	<link rel="stylesheet" type="text/css" href="/static/css/footer.css">
	<link rel="stylesheet" type="text/css" href="/static/css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="/static/css/Camera_list.css">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.1/js/bootstrap.min.js" integrity="sha384-XEerZL0cuoUbHE4nZReLT7nx9gQrQreJekYhJD9WNWhH8nEW+0c5qq7aIo2Wl30J" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

	<title>WATCHER</title>

	<style>
		.clickable{
			cursor: pointer;
		}
	</style>

</head>
<body>
	<!--내비게이션 바-->
	<nav class="navbar navbar-expand-lg navbar-light" style="background-color:black;">
		<a class="navbar-brand" href="#" style="color : #007bff; ">WATCHER</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<div class="navbar-nav">
				<ul class="nav navber-nav">
					<li><a href="#">홈 화면 <span class="sr-only">(current)</span></a></li>
					<li><a href="http://127.0.0.1:8000/store_list">가게 목록</a></li>
					<li><a href="#">가게 배치도</a></li>
				</ul>

			</div>
		 </div>
	</nav>

	<div class="wrap">


		<div class="container-fluid title">
		<h2>카메라 목록</h2>
		<p class="text-left">매장에 설치된 카메라 목록입니다.</p>
		</div>

		<div class="container-fluid" style=""> 
			<form class="form-inline" style="float: right; padding-bottom : 1%">
				<input type="text" id="keyword" class="search-query" placeholder="검색 내용"> <button type="submit" class="btn btn-sm btn-dark"  data-test='aaa' style="margin : 1px;">검색</button>
			</form>
		</div>
	
		<!--모달 form-->
		<!--카메라 정보 수정 모달 -->
		<div class="modal fade" id="modal_camera" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="exampleModalLabel"></h5>
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		      </div>
		      <div class="modal-body">
		        <form>
		          <div class="form-group">
		            <label for="camera-name" class="col-form-label">카메라 이름 :</label>
		            <input type="text" class="form-control" id="location" value="">
		          </div>
		          <div class="form-group">
		            <label for="mac-address" class="col-form-label"></label>
		           <input type="text" class="form-control" id="location" value="">
		          </div>
		          <div class="form-group">
		            <label for="description" class="col-form-label">비고 :</label>
		            <textarea class="form-control" id="message-text"></textarea>
		          </div>
		        </form>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
		        <button type="button" class="btn btn-primary">변경사항 저장</button>
		      </div>
		    </div>
		  </div>
		</div>

		<!--카메라 추가 모달 -->
		<div class="modal fade" id="modal_camera_add_btn" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="exampleModalLabel"></h5>
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		      </div>
		      <div class="modal-body">
		        <form>
		          <div class="form-group">
		            <label for="camera-name" class="col-form-label">카메라 위치 :</label>
		            <input type="text" class="form-control" id="modal_camera_location" value="">
		          </div>
		          <div class="form-group">
		            <label for="mac-address" class="col-form-label">Mac Address :</label>
		           <input type="text" class="form-control" id="" value="">
		          </div>
		          <div class="form-group">
		            <label for="description" class="col-form-label">비고 :</label>
		            <textarea class="form-control" id="modal_camera_description"></textarea>
		          </div>
		        </form>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
		        <button id ="modal_add_camera_btn" type="button" data-dismiss="modal" class="btn btn-primary">기기 추가</button>
		      </div>
		    </div>
		  </div>
		</div>

		<!--층 수 추가 모달 -->
		<div class="modal fade" id="modal_floor" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="exampleModalLabel"></h5>
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		      </div>
		      <div class="modal-body">
		        <form>
		          <div class="form-group">
		            <label for="floor_name" class="col-form-label">층 이름 :</label>
		            <input type="text" class="form-control" id="modal_floor_name" value="">
		          </div>
		          <div class="form-group">
		            <label for="floor_num" class="col-form-label">층 수 :</label>
		           <input type="text" class="form-control" id="modal_floor_num" value="">
		          </div>
		          <div class="form-group">
		            <label for="description" class="col-form-label">설명 :</label>
		            <textarea class="form-control" id="modal_floor_description"></textarea>
		          </div>
		        </form>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
		        <button id ="modal_add_floor_btn" type="button" data-dismiss="modal" class="btn btn-primary"> 추가</button>
		      </div>
		    </div>
		  </div>
		</div>

		<!--층 별 상세페이지 모달 -->

		<div class="modal fade" id="modal_floor_info" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="exampleModalLabel"></h5>
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		      </div>
		      <div class="modal-body">
		        <form>
		          <div class="form-group">
		            <label for="floor_name" class="col-form-label">층 이름 :</label>
		            <input type="text" class="form-control" id="modal_floor_name" value="">
		          </div>
		          <div class="form-group">
		            <label for="floor_num" class="col-form-label">층 수 :</label>
		           <input type="text" class="form-control" id="modal_floor_num" value="">
		          </div>
		          <div class="form-group">
		            <label for="description" class="col-form-label">설명 :</label>
		            <textarea class="form-control" id="modal_floor_description"></textarea>
		          </div>
		        </form>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
		        <button id ="modal_add_floor_btn" type="button" data-dismiss="modal" class="btn btn-primary"> 추가</button>
		      </div>
		    </div>
		  </div>
		</div>

		<!--모달 form 끝-->

		<!--카메라 테이블 시작-->
		<button style="float :left; margin-left : 1%; " id="add_button" data-toggle="modal" data-target="#modal_camera_add_btn" type="button" class="btn btn-dark">카메라 추가</button>

		<div class="table-responsive" style="height : 20vh; overflow: scroll;" >
		<!-- Table -->
			<table class="table table-striped table-bordered table-dark table-hover">
				<thead class="thead-light">
					<tr>
						<th data-column-id ="numeric" class="th-sm">#</th>
						<th data-column-id ="available" class="th-sm">이용 여부</th>
						<th data-column-id ="mac-address" class="th-sm">Mac Address</th>
						<th data-column-id ="description" class="th-sm">설명</th>
						<th data-column-id ="edit" class="th-sm">편집</th>
					</tr>
				</thead>
				
				<tbody id="tbody_camera" name="{{store_id}}"> <!--store_id 저장-->
					{% for list in camera_list%}
					<tr id="tr_list_{{list.pk}}">
						<td id="c_num_{{list.pk}}" >{{list.pk}}<i style="margin:4px" class="fa fa-camera"></i></td>
  						<td><i style="margin:4px" class="fa fa-eye"></i></td>
						<td class="clickable" id="c_num_{{list.pk}}" onclick='move_page(this)' link="{% url 'watcher:table_set' store_id list.pk %}">
							<a href= "{% url 'watcher:table_set' store_id list.pk %}">{{list.pk}}</a>
							<i style="margin:4px" class="fa fa-camera"></i>
						</td>
  						<td>{{list.cur_pic}}</td>
  						<td>{{list.pk}}<i style="margin:4px" class="fa fa-eye"></i></td>
  						<td>{{list.mac_addr}}</td>
  						<td>{{list.description}}</td>
  						<td><i type="button" name="{{list.pk}}" data-toggle="modal" data-target="#modal_camera"  style="margin:4px" class="fa fa-edit" id="td_camera_edit_button"><input type="hidden" name= "{{list.pk}}"></i><i style="margin:4px" class="fa fa-trash" name= "{{list.pk}}" id="td_camera_delete_button"></i></td>
  					</tr>
  					{% endfor %}
  					

  				</tbody>
  			</table>
  			
  		</div><!--container-fluid-->
  		<!-- 카메라 테이블 끝 -->

  		<button style="float :left; margin-top: 1%; margin-left : 1%; margin-bottom : 0.5%" id="add_floor_button" data-toggle="modal" data-target="#modal_floor" type="button" class="btn btn-dark" name="{{store_id}}">층 추가</button>
  		
  		<!--가게층 정보 리스트 테이블 시작 -->
		<div class="table-responsive" style="height : 20vh; overflow: scroll;" >
		<!-- Table -->
			<table class="table table-striped table-bordered table-dark table-hover">
				<thead class="thead-light">
					<tr>
						<th data-column-id ="th_floor_num" class="th-sm">층</th>
						<th data-column-id ="th_floor_name" class="th-sm">층 이름</th>
						<th data-column-id ="th_description" class="th-sm">설명</th>
						<th data-column-id ="th_edit" class="th-sm">편집</th>
					</tr>
				</thead>
				<tbody id="tbody_floor" name="{{store_id}}"> <!--store_id 저장-->
					{% for list in floor_list%}
					<tr id="tr_list_{{list.pk}}" link="{% url 'watcher:store_layout' store_id list.pk %}" onclick="move_page(this)">
						<td id="c_num_{{list.pk}}" >{{list.floor_num}}<i style="margin:4px" class="fa fa-camera"></i></td>
  						<td>{{list.name}}</td>
  						<td>{{list.description}}<i style="margin:4px" class="fa fa-eye"></i></td>
  						<td><i type="button" name="{{list.pk}}" data-toggle="modal" data-target="#modal_floor"  style="margin:4px" class="fa fa-edit" id="td_floor_edit_button"><input type="hidden" name= "{{list.pk}}"></i><i style="margin:4px" class="fa fa-trash" name= "{{list.pk}}" id="td_floor_delete_button"></i></td>
  					</tr>
  					{% endfor %}
  					

  				</tbody>
  			</table>
  			
  		</div><!--container-fluid-->
  		<!--가게층 정보 리스트 테이블 끝-->

</div>

  	</div><!--wrap-->
	<!--footer-->
	<footer>
		<div class="container">
					<br>
					<div class="row">
						<div class="col-sm-4" ><h5>Copyright &copy; 2020</h5>
							<ul>
							<li><h5>김민호(KIM MINHO)</h5></li>
							<li><h5>박지범(PARK JIBEOM)</h5></li>
							<li><h5>윤 렬(YOON RYEOL)</h5></li>
							</ul>
						</div>
						<div class="col-sm-4" ><h4>소개</h4><p></p></div>
						<div class="col-sm-4"><h4>위치</h4><p>서울특별시 동작구 상도동 숭실대학교</p></div>
					</div>
				</div>
	</footer>


<!--script start -->
	<script type="text/javascript">
		var page = 1;
		$(window).scroll(function() {
			if ($(window).scrollTop() == $(document).height() - $(window).height()) {
				console.log(++page);
				$("tbody").append('<tr><td>1<i style="margin:4px" class="fa fa-camera"></i></td><td>카메라1</td><td>창가 천장 위</td><td><i style="margin:4px" class="fa fa-edit"></i><i style="margin:4px" class="fa fa-trash"></i></td></tr>');
			}
		});

	/* 검색기능 */
		$(document).ready(function(){
			$("#keyword").on("keyup", function() {
				var value = $(this).val().toLowerCase();
				$("tbody tr").filter(function() {
					$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
				});
			});
		});


	/* 테이블 row edit 모달 버튼 기능 */
		$(document).on('click', '#td_camera_edit_button', function(e){
			var pk_check = $(this).attr('name');
			console.log(pk_check);
			$.ajax({
				url:"{% url 'watcher:ajax_get_camera_info' %}",
				dataType : "json",
				data:{
					'pk': pk_check
				},
				type:'GET',
				success:function(data){
					console.log(data)
					$('#exampleModalLabel').val(data.pk+"번카레마")
					$('.modal-title').text(data.pk+"번 카메라")

				},
			});
		});

		/* 테이블 row 삭제 버튼 기능 */
		$(document).on('click', '#td_camera_delete_button', function(e) {
			var pk = $(this).attr('name');
			var store_id = $('tbody').attr('name');

			console.log(store_id);
			if(confirm("삭제 하시겠습니까?")) {
				$.ajax({
						url:"{% url 'watcher:ajax_delete_camera_list' %}",
						dataType : "json",
						type : 'GET',
						data:{
							'pk': pk,
							'store_id' : store_id,
						},
						success : function(data){
							$('#tr_list_'+pk).remove();
						},
						error: function (error) {
						alert('error; ' + eval(error));
					}

				});
				return true;
			}
			else {
				return false;
			}
		});

		/*카메라 추가 기능 in 모달 */
		$(document).on('click', '#modal_add_camera_btn', function(e) {
			var camera_location = $('#modal_camera_location').val();
			var camera_description = $('#modal_camera_description').val();
			var store_id = "{{store_id}}"
			
			if (confirm('정말 추가 하시겠습니까?')) {

				console.log(camera_location);
			console.log(camera_description);
			console.log("{{store_id}}");
				$.ajax({
					url: "{% url 'watcher:ajax_add_camera_list' %}",
					dataType : "json",
					data: {
						'cur_pic' : camera_location,
						'description' : camera_description,
						'store_id' : store_id,
					},
					type : 'GET',
					success: function(data) {
						console.log('save')
						$('#tbody_camera').append('<tr id="tr_list_'+data.pk+'"><td id="c_num_'+data.pk+'" >'+data.pk+'<i style="margin:4px" class="fa fa-camera"></i></td><td><i style="margin:4px" class="fa fa-eye"></i></td><td>'+data.mac_addr+'</td><td>'+data.description+'</td><td><i type="button" name="'+data.pk+'" data-toggle="modal" data-target="#modal_camera"  style="margin:4px" class="fa fa-edit" id="td_edit_button"><input type="hidden" name= "'+data.pk+'"></i><i style="margin:4px" class="fa fa-trash" name= "'+data.pk+'" id="td_camera_delete_button"></i></td></tr>');
						
					},
					error: function (error) {
						alert('error; ' + eval(error));
					}

				});
				return true;
			}
			else
			{
				return false;
			}

		
		});
		
		/* 층 추가 modal 버튼 */
		$(document).on('click', '#modal_add_floor_btn', function(e) {
			var store_id = "{{store_id}}"
			var floor_name = $('#modal_floor_name').val();
			var floor_num = $('#modal_floor_num').val();
			var description = $('#modal_floor_description').val();
			console.log(store_id);

			if(confirm("정말 추가 하시겠습니까?")) {
				$.ajax({
					url : "{% url 'watcher:ajax_add_floor_info' %}",
					dataType : "json",
					type :'GET',
					data : {
						'store_id' : store_id,
						'floor_name' : floor_name,
						'floor_num' : floor_num,
						'description' : description,
					},
					success : function(data) {
						console.log(data.pk);
						console.log(data.floor_num);
						$('#tbody_floor').append('<tr id="tr_list_'+data.pk+'"><td id="c_num_'+data.pk+'">'+data.floor_num+'<i style="margin:4px" class="fa fa-camera"></i></td><td>'+data.name+'</td><td>'+data.description+'<i style="margin:4px" class="fa fa-eye"></i></td><td><i type="button" name="'+data.pk+'" data-toggle="modal" data-target="#modal_camera"  style="margin:4px" class="fa fa-edit" id="td_floor_edit_button"><input type="hidden" name= "'+data.pk+'"></i><i style="margin:4px" class="fa fa-trash" name= "'+data.pk+'" id="td_floor_delete_button"></i></td></tr>')
					},
					error: function (error) {
							alert('error; ' + eval(error));
					}
				});
				return true;
			}
			else
			{
				return false
			}

		});

		/* 층 edit 버튼 */
		$(document).on('click', '#td_floor_edit_button', function(e) {

		}
		)
		
		//move to camera seat data edit page - YR
		function move_page(el){
    		var addr = $(el).attr('link')
			location.href = addr
  		}	

	</script>


<!--script end-->
</body>
</html>
