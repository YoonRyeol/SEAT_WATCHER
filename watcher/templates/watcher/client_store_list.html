<!DOCTYPE html>
<html style="font-size:10px">
<head>
	<meta charset="uft-8">
	<meta name="viewprot" content="width=device-width, inital-scale=1, shrinkt-to-fit=no">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
	
	<link rel="stylesheet" type="text/css" href="/static/css/footer.css">
	<link rel="stylesheet" type="text/css" href="/static/css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="/static/css/Camera_list.css">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.1/js/bootstrap.min.js" integrity="sha384-XEerZL0cuoUbHE4nZReLT7nx9gQrQreJekYhJD9WNWhH8nEW+0c5qq7aIo2Wl30J" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

	<title>WATCHER</title>
</head>
<body>
	<div class="container-fluid" style="padding:0;">
	
		<nav class="navbar fixed-top navbar-light bg-dark" style="position:sticky; top:0; height:7vh; margin-bottom:1rem;">
			<div class="navbar-header"> 
				<a style="font-size:3.5rem; color:white;" class="navbar-brand navbar-lg" href="{% url 'watcher:client_store_list' %}">WATCHER</a>
			</div>
			<input style="font-size: 2.6rem; border-top-right-radius: 0.8em; border-top-left-radius: 0.8em; border-bottom-right-radius: 0.8em; border-bottom-left-radius: 0.8em; width:30%; height:50%" id="client_keyword" placeholder="검색" />
		</nav>
		<div id="container_store_list" class="container-fluid" style="overflow:scroll; min-height: 100vh;">
		
		</div>

		
	</div>


	<nav class="navbar fixed-bottom navbar-light bg-dark" style="position:sticky; bottom:0; height:11%; margin-top:1rem;">
		<div class="container-fluid">
			<div class="row">
				<div class="col-4" style="display:block; text-align: center;"><a style="color: white;" href="#" ><i class="fa fa-home fa-5x"></i><h1>홈</h1></a></div>
				<div class="col-4" style="display:block; text-align: center;"><a style="color: white;" href="#" ><i class="fa fa-heart fa-5x"></i><h1>찜</h1></a></div>
				<div class="col-4" style="display:block; text-align: center;"><a style="color: white;" href="#" ><i class="fa fa-home fa-5x"></i><h1>home</h1></a></div>
			</div>
		</div>
	</nav>

	
</body>
<script>

	//검색기능
	$(document).ready(function(){
		$("#client_keyword").on("keyup", function() {
			var value = $(this).val().toLowerCase();
			$("#container_store_list > div").filter(function() {
					$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
				});
			});

		});

	function create_store_info(list){
		$('#container_store_list').append('<div class="row" style="border: solid black 1px; margin-left:4%; margin-right:4%; border-top-right-radius: 3.8em; border-top-left-radius: 3.8em; border-bottom-right-radius: 3.8em; border-bottom-left-radius: 3.8em; margin-bottom:3.5rem;"><div class="col-12" style="height:36vh; padding:0;"><div class="card" style="height:100%; width:100%; border-top-right-radius: 3.8em; border-top-left-radius: 3.8em; border-bottom-right-radius: 3.8em; border-bottom-left-radius: 3.8em;"><img src="/static/img/modal_cafe_img.jpg" alt="" class="card-img-top" style="height:60%; border-top-right-radius: 3.8em; border-top-left-radius: 3.8em; border-bottom-right-radius: 3.8em; border-bottom-left-radius: 3.8em;"><div class="card-body" style="height:90%;"><h1 class="card-title" style="font-size:7rem;">'+list.store_name+'</h1><h3 style="color:gray; display:inline-block;">위치 : '+list.store_location+'</h3><a href="#" class="btn btn-dark btn-lg" id="next_page_button" data-pk="'+list.pk+'"style="font-size:3rem; display:inline-block; float:right;">매장 확인</a></div></div></div></div>')
		
	}

	var page = 1;
	var store_list;


	//페이지 네이션 구현 부분
	function store_pagination() {
		$.ajax({
			url : "{% url 'watcher:ajax_get_client_store_list' %}",
			dataType: 'json',
			type :'GET',
			data : {
				
				'page' : page,
			},
			success : function(data) {
				store_list = data;
				console.log(store_list.length);
				for(var i = 0; i < store_list.length; i++) {
					console.log("pk : "+store_list[i].pk);
					create_store_info(store_list[i]);
				}
				page = page+1;
			},

		});
	}

	$(document).ready(function(){
		if(page==1){
			console.log("page : "+page);
			store_pagination();
		}
	});

	//이후 스크롤이 일정범위 벗어나면 5개씩 추가로 가져옴
	var page_end = 0;
	window.onscroll = function(e) {
		var keyword = $('#client_keyword').val();

		if(keyword != "") return;
		console.log("scoll start page :"+page);

    //window height + window scrollY 값이 document height보다 클 경우,
	    $(document).ready(function(){
	    	var element = document.getElementById('container_store_list');
	    	
	    //	console.log("innerHeight : " + window.innerHeight);
	    //	console.log("scrollY : " + window.scrollY);
	    //	console.log(element.offsetHeight);
	    	
	    	if((window.innerHeight + window.scrollY) >= element.offsetHeight) {
	    		store_pagination();
	    	}//if end
	    });
    };

	$(document).on('click', '#next_page_button', function(e){
		let target_pk = $(e.target).data('pk')
		console.log($(e.target).data('pk'))
		location.href="/client_page/" + target_pk
	});
</script>
</html>