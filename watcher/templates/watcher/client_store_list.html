<!DOCTYPE html>
<html style="font-size:10px">
<head>
	<meta charset="uft-8">
	<meta name="viewprot" content="width=device-width, inital-scale=1, shrinkt-to-fit=no">


	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css">
	
	<link rel="stylesheet" type="text/css" href="/static/css/footer.css">
	<link rel="stylesheet" type="text/css" href="/static/css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="/static/css/Camera_list.css">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.1/js/bootstrap.min.js" integrity="sha384-XEerZL0cuoUbHE4nZReLT7nx9gQrQreJekYhJD9WNWhH8nEW+0c5qq7aIo2Wl30J" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


	<link rel="stylesheet" type="text/css" href="/static/css/client_store_list.css">

	<title>WATCHER</title>
</head>
<body>
	<div class="container-fluid" style="padding:0;">
	
		<nav class="navbar fixed-top navbar-light bg-dark" style="position:sticky; top:0; height:7vh; margin-bottom:1rem;">
			<div class="navbar-header"> 
				<a style="font-size:3.5rem; color:white;" class="navbar-brand navbar-lg" href="{% url 'watcher:client_store_list' %}">WATCHER</a>
			</div>
			
			
			<div class="input-group mb-3" style="height:80%; min-width:18%; width:35%; float:right; padding:2%;">
				<input type="text" id="client_search_keyword" class="form-control" placeholder="검색 내용" aria-label="검색 내용" aria-describedby="button-addon2" style="font-size: 2.6rem; height:100%;">
				<div class="input-group-append" style="background-color: black; border-top-right-radius: 0.3em; border-bottom-right-radius: 0.3em; min-width:18%; width:18%;" align="center">
					<i type="button" id="client_search_btn" class="fa fa-search fa-2x fa-fw" style="padding:1%; width:100%; color:white; height:100%; position:relative; top:0.4rem;"></i>
				</div>
			</div>

		<!--	<input style="font-size: 2.6rem; border-top-right-radius: 0.8em; border-top-left-radius: 0.8em; border-bottom-right-radius: 0.8em; border-bottom-left-radius: 0.8em; width:30%; height:50%" id="client_keyword" placeholder="검색" />-->
		</nav>
		<div id="container_store_list" class="container-fluid" style="overflow:scroll; min-height: 100vh;">
			<div class="row" style="border: solid black 1px; margin-left:4%; margin-right:4%; border-top-right-radius: 3.8em; border-top-left-radius: 3.8em; border-bottom-right-radius: 3.8em; border-bottom-left-radius: 3.8em; margin-bottom:3.5rem;">
				<div class="col-12" style="height:36vh; padding:0; ">
					<div class="card" style="height:100%; width:100%; border-top-right-radius: 3.8em; border-top-left-radius: 3.8em; border-bottom-right-radius: 3.8em; border-bottom-left-radius: 3.8em;">
						<img src="'+path+'" alt="" class="card-img-top" style="height:60%; border-top-right-radius: 3.8em; border-top-left-radius: 3.8em; border-bottom-right-radius: 3.8em; border-bottom-left-radius: 3.8em;">
						<div class="card-body" style="height:90%;">
							<div><h1 class="card-title" style="font-size:7rem; display: inline-block;">'+list.store_name+'</h1><i type="button" name="heart_empty_btn" class="far fa-heart fa-6x" style="float:right; padding:2%;"></i></div>
							<h3 style="display:block; color:gray;">위치 : '+list.store_location+'</h3>
							<div class="container-fluid" name="card-footer" style="position:absolute; right:0px; bottom:0px; padding-bottom: 2%;">
								<a href="#" class="btn btn-dark btn-lg" id="next_page_button" data-pk="" style="font-size:4rem; float:right; border-top-right-radius: 0.5em; border-top-left-radius: 0.5em; border-bottom-right-radius: 0.5em; border-bottom-left-radius: 0.5em; padding:1.5%;">방문하기</a>
							</div>
						</div>
					</div>
				</div>
			
			</div>
		</div>

	</div>


	<nav class="navbar fixed-bottom navbar-light bg-dark" style="position:sticky; bottom:0; height:11%; margin-top:1rem;">
		<div class="container-fluid">
			<div class="row">
				<div class="col-6" id="bottom_home" style="display:block; text-align: center;"><a style="color: white; text-decoration:none" href="#" ><i class="fa fa-home fa-6x" id="bottom_home_btn" type="button"></i><h1>홈</h1></a></div>
				<div class="col-6" id="bottom_liked" style="display:block; text-align: center;"><a style="color: white; text-decoration:none" href="#" ><i class="fa fa-heart fa-4x" id="bottom_liked_btn" type="button"></i><h1>찜</h1></a></div>
			
			</div>
		</div>
	</nav>

	
</body>
<script>

	var page = 1;
	//var liked_list = $('i[name="heart_btn"]');
	var liked_list = $('row');
	var liked_list_pk = new Array();

	$(document).ready(function(e){
		liked_list = $('i[name="heart_btn"]');		
		for(var i =0; i<liked_list.length; i++){
			liked_list_pk = liked_list[i].dataset.pk;
		}

	});
	//검색기능
	var search_keyword;

	$(document).ready(function(e) {
		$('#client_search_keywords').keydown(function(e){
			if(e.keyCode==13) {
				search_keyword = $(this).val();
				console.log("enter");
				page = 1;
				//console.log("enter : " + $(this).val());
				$.ajax({
					url: "{% url 'watcher:ajax_search_client_store_list' %}",
					dataType:'json',
					type :'GET',
					data : {
						'page' : page,
						'search_keyword' : search_keyword,
					},
					success : function(data) {
						$('#container_store_list').empty();
						for(var i=0; i<data.length; i++) {
							create_store_info(data[i]);
						}
						page = page+1;
					},

				})
			}
		});
	});

	//찜기능
	$(document).on('click','i[name=heart_empty_btn]',function(e){
		console.log("like");
		$(this).attr('class','fas fa-heart fa-6x');
		$(this).attr('name', 'heart_btn');
	});
	$(document).on('click','i[name=heart_btn]',function(e){
		console.log("changed empty");
		$(this).attr('class','far fa-heart fa-6x');
		$(this).attr('name', 'heart_empty_btn');
	});


	//좋아요한 리스트
	$(document).on('click','i[name="heart_empty_btn"]',function(e){
		liked_list = $('row');

		console.log("list:"+liked_list.length);
		liked_list_pk = new Array();

		for(var i = 0; i<liked_list.length; i++){
			//liked_list_pk = liked_list[i].dataset.pk;
			//console.log("pk : "+liked_list_pk);
			console.log(liked_list[i]);
		}
	});

	$(document).on('click','i[name="heart_btn"]',function(e){
		liked_list = $('i[name="heart_btn"]');

		console.log("list:"+liked_list.length);
		liked_list_pk = new Array();

		for(var i = 0; i<liked_list.length; i++){
			liked_list_pk = liked_list[i].dataset.pk;
			console.log("pk : "+liked_list_pk);
		}
	});

	//하단 메뉴 선택시 활성화 표시
	var store_list;

	$(document).on('click', '#bottom_home', function(e) {
		console.log("click home");
		$('#bottom_home_btn').attr('style','display:block; text-align:center; ');
		$('#bottom_home_btn').attr('class','fa fa-home fa-6x')

		$('#bottom_liked_btn').attr('class','fa fa-heart fa-4x');
	});

	$(document).on('click', '#bottom_liked', function(e) {
		console.log("click liked");
		$('#bottom_liked_btn').attr('style','display:block; text-align:center;');
		$('#bottom_liked_btn').attr('class','fa fa-heart fa-6x')
		
		$('#bottom_home_btn').attr('class','fa fa-home fa-4x');

		$.ajax({
			url: "{% url 'watcher:ajax_client_liked_list' %}",
			type : 'GET',
			data :{
				'pk' : liked_list_pk,

			},
			success : function(data){
				$('#container_store_list').empty();

				for(var i=0; i<data.length; i++) {
					create_store_info(data);
				}
			},
		})


	});

	//스크롤 위치 기억


	//가게 목록 생성 함수

	function create_store_info(list){
		var path;
		if(list.picture_name == "modal_cafe_img.jpg" ){
			path = "/static/img/store/modal_cafe_img.jpg";
			console.log("path :" + path);
		}
		else {
			path = "/static/img/store/"+list.pk+"/"+list.picture_name;
			//path = "/static/img/modal_cafe_img.jpg";
			console.log("path :" + path);
		}
		$('#container_store_list').append('<div class="row" style="border: solid black 1px; margin-left:4%; margin-right:4%; border-top-right-radius: 3.8em; border-top-left-radius: 3.8em; border-bottom-right-radius: 3.8em; border-bottom-left-radius: 3.8em; margin-bottom:3.5rem;"><div class="col-12" style="height:36vh; padding:0; "><div class="card" style="height:100%; width:100%; border-top-right-radius: 3.8em; border-top-left-radius: 3.8em; border-bottom-right-radius: 3.8em; border-bottom-left-radius: 3.8em;"><img src="'+path+'" alt="" class="card-img-top" style="height:60%; border-top-right-radius: 3.8em; border-top-left-radius: 3.8em; border-bottom-right-radius: 3.8em; border-bottom-left-radius: 3.8em;"><div class="card-body" style="height:90%;"><div><h1 class="card-title" style="font-size:7rem; display: inline-block;">'+list.store_name+'</h1><i type="button" name="heart_empty_btn" class="far fa-heart fa-6x" data-pk="'+list.pk+'" style="color:red; float:right; padding:2%;"></i></div><h3 style="display:block; color:gray;" >위치 : '+list.store_location+'</h3><div class="container-fluid" name="card-footer" style="position:absolute; right:0px; bottom:0px; padding-bottom: 2%;"><a href="#" class="btn btn-dark btn-lg" id="next_page_button" data-pk="'+list.pk+'" style="font-size:4rem; float:right; border-top-right-radius: 0.5em; border-top-left-radius: 0.5em; border-bottom-right-radius: 0.5em; border-bottom-left-radius: 0.5em; padding:1.5%;">방문하기</a></div></div></div></div>')
		
	}


	//페이지 네이션 구현 부분
	function store_pagination() {
		$.ajax({
			url : "{% url 'watcher:ajax_get_client_store_list' %}",
			dataType: 'json',
			type :'GET',
			data : {
				'page' : page,
				'search_keyword' : search_keyword,
			},
			success : function(data) {
				store_list = data;
				console.log(store_list.length);
				for(var i = 0; i < store_list.length; i++) {
					console.log("pk : "+store_list[i].pk);
					create_store_info(store_list[i]);
				}
				page = page+1;
			},

		});
	}

	$(document).ready(function(){
		if(page==1){
			console.log("page : "+page);
			store_pagination();
		}
	});

	//이후 스크롤이 일정범위 벗어나면 5개씩 추가로 가져옴
	window.onscroll = function(e) {
		var keyword = $('#client_search_keyword').val();

		//if(keyword != "") return;
		console.log("scoll start page :"+page);

    //window height + window scrollY 값이 document height보다 클 경우,
	    $(document).ready(function(){
	    	var element = document.getElementById('container_store_list');
	    	
	    	console.log("innerHeight : " + window.innerHeight);
	    	console.log("scrollY : " + window.scrollY);
	    	console.log(element.offsetHeight);
	    	
	    	if((window.innerHeight + window.scrollY) >= element.offsetHeight) {
	    		store_pagination();
	    	}//if end
	    });
    };

    //매장 방문버튼 클릭시 페이지 이동
	$(document).on('click', '#next_page_button', function(e){
		let target_pk = $(e.target).data('pk')
		console.log($(e.target).data('pk'))
		location.href="/client_page/" + target_pk
	});

	
</script>
</html>